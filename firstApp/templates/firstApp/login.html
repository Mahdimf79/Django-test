<div><p id="error"></p></div>

<form method="post" id="form">
  {% csrf_token %}
     <input type="text" placeholder="Username: " name="username" id="user"/>
     <input type="text" placeholder="Password: " name="password" id="pass"/>

     <button type="submit" id="sub">
       Submit
     </button>
</form>

{% block javascript %}
<script>

    const form = document.getElementById('form');

    form.addEventListener('submit', handleSubmit);

    function handleSubmit(e) {
      e.preventDefault();

      const username = document.getElementById('user').value;

      const password = document.getElementById('pass').value;

      const error = document.getElementById('error');

      if(username.length >= 5 && username.length <= 30){
        if(password.length >= 8 && password.length <= 64){
          fetch('http://127.0.0.1:8000/firstApp/login_set/',{
             method: 'POST',
             headers: { 'Content-Type': 'application/x-www-form-urlencoded',
               "X-CSRFToken": '{{csrf_token}}',
             },
             body: `username=${username}&password=${password}`
         })
          .then(response => response.json())
          .then(data => {
            if(data.ok){
              window.location.href = "http://127.0.0.1:8000/firstApp/";
            }else{
              error.innerHTML = "field join"
            }
          });
        console.log('{{ csrf_token }}')
        }else{
          error.innerHTML = "The number of characters in the password is not allowed";
        }
      }else{
        error.innerHTML = "The number of characters in the username is not allowed";
      }
    }

</script>
{% endblock javascript %}
